<refentry id="glib-changes" revision="17 Jan 2002">
<refmeta>
<refentrytitle>GLib 的更改</refentrytitle>
<manvolnum>3</manvolnum>
<refmiscinfo>GLib 的更改</refmiscinfo>
</refmeta>

<refnamediv>
<refname>GLib 的更改</refname>
<refpurpose>
和先前版本的 GLib 之间不兼容的更改
</refpurpose>
</refnamediv>


<refsect1>
<title>从 2.0 到 2.2 的不兼容更改</title>

<itemizedlist>

<listitem>
<para>
GLib 更改了伪随机数生成器-赛特旋转 (Mersenne Twister，
就是 <structname>GRand</structname> 和 
<structname>GRandom</structname> 所使用的) 的种子算法。 
这是必须的，因为一些种子可能产生很差的伪随机流。
使用新版本的 GLib <function>g_rand*_int_range()</function> 
产生的随机整数也会有稍微好一点的公平分配。
</para>

<para>
网页上关于赛特旋转(Mersenne Twister)伪随机数生成器的进一步信息在 <ulink
url="http://www.math.keio.ac.jp/~matumoto/emt.html">http://www.math.keio.ac.jp/~matumoto/emt.html</ulink>.
</para> 

<para>
2.0.x 中的旧的种子和生成算法可以通过设置环境变量 <envar>G_RANDOM_VERSION</envar> 
为 '2.0',来替代新版使用。只在您有的确需要传承的 Glib-2.0 产生的数字序列时
才使用 GLib-2.0 的算法。
</para> 

</listitem>

</itemizedlist>

</refsect1>

<refsect1>
<title>从 1.2 到 2.0 的不兼容更改</title>

<para>
位于 <ulink
url="http://developer.gnome.org">http://developer.gnome.org</ulink>
的 <ulink url="http://developer.gnome.org/dotplan/porting/">GNOME 2.0
移植指南</ulink>有更多的从 1.2 到 2.0 移植的细节讨论。请阅读 GLib 一节。
</para>

<itemizedlist>

<listitem>
<para>
事件循环功能 <structname>GMain</structname> 已经广泛的修订，
以支持在分离线程的多个分离的主循环。
所有 sources (计时、空闲等函数) 都与<structname>GMainContext</structname>联系起来了。
</para>

<para>
仍然存在兼容函数，以使多数处理主循环的程序代码能继续工作。
但是创建新的 sources 的自定义类型的代码需要修改。
</para>

<para>
主要的修改是：

  <itemizedlist>

  <listitem>
  <para>
   Sources 以 <type>GSource *</type> 暴露，而不是仅仅是数字 id。
  </para>
  </listitem>
  
  <listitem>
  <para>
   "derivation" 结构 从<structname>GSource</structname>创建一个 sources 新类型，
   所以虚函数 <structname>GSource</structname>的<literal>source_data</literal> 参数
   被替换为 <type>GSource *</type>.
  </para>
  </listitem>
  
  <listitem>
  <para>
   Sources 刚刚创建，于是稍候被添加到了具体的 <structname>GMainContext</structname>。
  </para>
  </listitem>
  
  <listitem>
  <para>
   修改了调度，以使回调和数据都可以传递给 <function>dispatch()</function>虚函数。
  </para>
  </listitem>

  </itemizedlist>
  为了顺应这一变化, <structname>GIOChannel</structname> 的 vtable 改变了，同时
  <function>add_watch()</function> 被替换为
  <function>create_watch()</function>.
</para>
</listitem>

<listitem>
<para>
更改了<function>g_list_foreach()</function> and 
<function>g_slist_foreach()</function> ，
以使它们安全的应对移除当前条目，而不是下一条目。
</para>

<para>
在任何情况下回调这些函数时，都不推荐变更这些链表。
</para>
</listitem>

<listitem>
<para>
<structname>GDate</structname> 现在用 UTF-8，而不是当前区域设置。
如果希望使用它处理当前区域的编码，
您需要首先使用<function>g_locale_to_utf8()</function>转换字符串的编码。
</para>
</listitem>

<listitem>
<para>
<function>g_strsplit()</function> 被更正为：

  <itemizedlist>
  <listitem>
  <para>
   包含结尾的空标记，而不是剥离它们
  </para>
  </listitem>
  <listitem>
  <para>
   最多分割为 <literal>max_tokens</literal> 节, 而不是
   <literal>max_tokens + 1</literal>
  </para>
  </listitem>
  </itemizedlist>

  所有依赖于这些 bug 的代码需要更正。
</para>
</listitem>

<listitem>
<para>
移除的过时函数：
<function>g_set_error_handler()</function>, 
<function>g_set_warning_handler()</function>,
<function>g_set_message_handler()</function>, 使用 
<function>g_log_set_handler()</function> 来替代.
</para>
</listitem>
</itemizedlist>

</refsect1>

</refentry>
